/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

SnapToGeometry=function(_1445){SnapToHelper.call(this,_1445);};SnapToGeometry.prototype=new SnapToHelper;SnapToGeometry.THRESHOLD=5;SnapToGeometry.prototype.snapPoint=function(_1446,_1447,_1448){if(this.rows==null||this.cols==null){this.populateRowsAndCols();}if((_1446&SnapToHelper.EAST)!=0){var _1449=this.getCorrectionFor(this.cols,_1447.getX()-1,1);if(_1449!=SnapToGeometry.THRESHOLD){_1446&=~SnapToHelper.EAST;_1448.x+=_1449;}}if((_1446&SnapToHelper.WEST)!=0){var _144a=this.getCorrectionFor(this.cols,_1447.getX(),-1);if(_144a!=SnapToGeometry.THRESHOLD){_1446&=~SnapToHelper.WEST;_1448.x+=_144a;}}if((_1446&SnapToHelper.SOUTH)!=0){var _144b=this.getCorrectionFor(this.rows,_1447.getY()-1,1);if(_144b!=SnapToGeometry.THRESHOLD){_1446&=~SnapToHelper.SOUTH;_1448.y+=_144b;}}if((_1446&SnapToHelper.NORTH)!=0){var _144c=this.getCorrectionFor(this.rows,_1447.getY(),-1);if(_144c!=SnapToGeometry.THRESHOLD){_1446&=~SnapToHelper.NORTH;_1448.y+=_144c;}}return _1446;};SnapToGeometry.prototype.snapRectangle=function(_144d,_144e){var _144f=_144d.getTopLeft();var _1450=_144d.getBottomRight();var _1451=this.snapPoint(SnapToHelper.NORTH_WEST,_144d.getTopLeft(),_144f);_144e.x=_144f.x;_144e.y=_144f.y;var _1452=this.snapPoint(SnapToHelper.SOUTH_EAST,_144d.getBottomRight(),_1450);if(_1451&SnapToHelper.WEST){_144e.x=_1450.x-_144d.getWidth();}if(_1451&SnapToHelper.NORTH){_144e.y=_1450.y-_144d.getHeight();}return _1451|_1452;};SnapToGeometry.prototype.populateRowsAndCols=function(){this.rows=new Array();this.cols=new Array();var _1453=this.workflow.getDocument().getFigures();var index=0;for(var i=0;i<_1453.getSize();i++){var _1456=_1453.get(i);if(_1456!=this.workflow.getCurrentSelection()){var _1457=_1456.getBounds();this.cols[index*3]=new SnapToGeometryEntry(-1,_1457.getX());this.rows[index*3]=new SnapToGeometryEntry(-1,_1457.getY());this.cols[index*3+1]=new SnapToGeometryEntry(0,_1457.x+(_1457.getWidth()-1)/2);this.rows[index*3+1]=new SnapToGeometryEntry(0,_1457.y+(_1457.getHeight()-1)/2);this.cols[index*3+2]=new SnapToGeometryEntry(1,_1457.getRight()-1);this.rows[index*3+2]=new SnapToGeometryEntry(1,_1457.getBottom()-1);index++;}}};SnapToGeometry.prototype.getCorrectionFor=function(_1458,value,side){var _145b=SnapToGeometry.THRESHOLD;var _145c=SnapToGeometry.THRESHOLD;for(var i=0;i<_1458.length;i++){var entry=_1458[i];var _145f;if(entry.type==-1&&side!=0){_145f=Math.abs(value-entry.location);if(_145f<_145b){_145b=_145f;_145c=entry.location-value;}}else{if(entry.type==0&&side==0){_145f=Math.abs(value-entry.location);if(_145f<_145b){_145b=_145f;_145c=entry.location-value;}}else{if(entry.type==1&&side!=0){_145f=Math.abs(value-entry.location);if(_145f<_145b){_145b=_145f;_145c=entry.location-value;}}}}}return _145c;};SnapToGeometry.prototype.onSetDocumentDirty=function(){this.rows=null;this.cols=null;};