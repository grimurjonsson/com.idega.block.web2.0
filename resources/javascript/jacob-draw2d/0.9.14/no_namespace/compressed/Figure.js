/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

Figure=function(){this.construct();};Figure.prototype.type="Figure";Figure.ZOrderBaseIndex=100;Figure.setZOrderBaseIndex=function(index){Figure.ZOrderBaseIndex=index;};Figure.prototype.construct=function(){this.lastDragStartTime=0;this.x=0;this.y=0;this.border=null;this.setDimension(10,10);this.id=this.generateUId();this.html=this.createHTMLElement();this.canvas=null;this.workflow=null;this.draggable=null;this.parent=null;this.isMoving=false;this.canSnapToHelper=true;this.snapToGridAnchor=new Point(0,0);this.timer=-1;this.setDeleteable(true);this.setCanDrag(true);this.setResizeable(true);this.setSelectable(true);this.properties=new Object();this.moveListener=new ArrayList();};Figure.prototype.dispose=function(){this.canvas=null;this.workflow=null;this.moveListener=null;if(this.draggable!=null){this.draggable.removeEventListener("mouseenter",this.tmpMouseEnter);this.draggable.removeEventListener("mouseleave",this.tmpMouseLeave);this.draggable.removeEventListener("dragend",this.tmpDragend);this.draggable.removeEventListener("dragstart",this.tmpDragstart);this.draggable.removeEventListener("drag",this.tmpDrag);this.draggable.removeEventListener("dblclick",this.tmpDoubleClick);this.draggable.node=null;}this.draggable=null;if(this.border!=null){this.border.dispose();}this.border=null;if(this.parent!=null){this.parent.removeChild(this);}};Figure.prototype.getProperties=function(){return this.properties;};Figure.prototype.getProperty=function(key){return this.properties[key];};Figure.prototype.setProperty=function(key,value){this.properties[key]=value;this.setDocumentDirty();};Figure.prototype.getId=function(){return this.id;};Figure.prototype.setCanvas=function(_1155){this.canvas=_1155;};Figure.prototype.getWorkflow=function(){return this.workflow;};Figure.prototype.setWorkflow=function(_1156){if(this.draggable==null){this.html.tabIndex="0";var oThis=this;this.keyDown=function(event){event.cancelBubble=true;event.returnValue=true;oThis.onKeyDown(event.keyCode,event.ctrlKey);};if(this.html.addEventListener){this.html.addEventListener("keydown",this.keyDown,false);}else{if(this.html.attachEvent){this.html.attachEvent("onkeydown",this.keyDown);}}this.draggable=new Draggable(this.html,Draggable.DRAG_X|Draggable.DRAG_Y);this.draggable.node=this;this.tmpContextMenu=function(_1159){oThis.onContextMenu(oThis.x+_1159.x,_1159.y+oThis.y);};this.tmpMouseEnter=function(_115a){oThis.onMouseEnter();};this.tmpMouseLeave=function(_115b){oThis.onMouseLeave();};this.tmpDragend=function(_115c){oThis.onDragend();};this.tmpDragstart=function(_115d){var w=oThis.workflow;w.showMenu(null);if(oThis.workflow.toolPalette&&oThis.workflow.toolPalette.activeTool){_115d.returnValue=false;oThis.workflow.onMouseDown(oThis.x+_115d.x,_115d.y+oThis.y);oThis.workflow.onMouseUp(oThis.x+_115d.x,_115d.y+oThis.y);return;}_115d.returnValue=oThis.onDragstart(_115d.x,_115d.y);};this.tmpDrag=function(_115f){oThis.onDrag();};this.tmpDoubleClick=function(_1160){oThis.onDoubleClick();};this.draggable.addEventListener("contextmenu",this.tmpContextMenu);this.draggable.addEventListener("mouseenter",this.tmpMouseEnter);this.draggable.addEventListener("mouseleave",this.tmpMouseLeave);this.draggable.addEventListener("dragend",this.tmpDragend);this.draggable.addEventListener("dragstart",this.tmpDragstart);this.draggable.addEventListener("drag",this.tmpDrag);this.draggable.addEventListener("dblclick",this.tmpDoubleClick);}this.workflow=_1156;};Figure.prototype.createHTMLElement=function(){var item=document.createElement("div");item.id=this.id;item.style.position="absolute";item.style.left=this.x+"px";item.style.top=this.y+"px";item.style.height=this.width+"px";item.style.width=this.height+"px";item.style.margin="0px";item.style.padding="0px";item.style.outline="none";item.style.zIndex=""+Figure.ZOrderBaseIndex;return item;};Figure.prototype.setParent=function(_1162){this.parent=_1162;};Figure.prototype.getParent=function(){return this.parent;};Figure.prototype.getZOrder=function(){return this.html.style.zIndex;};Figure.prototype.setZOrder=function(index){this.html.style.zIndex=index;};Figure.prototype.hasFixedPosition=function(){return false;};Figure.prototype.getMinWidth=function(){return 5;};Figure.prototype.getMinHeight=function(){return 5;};Figure.prototype.getHTMLElement=function(){if(this.html==null){this.html=this.createHTMLElement();}return this.html;};Figure.prototype.paint=function(){};Figure.prototype.setBorder=function(_1164){if(this.border!=null){this.border.figure=null;}this.border=_1164;this.border.figure=this;this.border.refresh();this.setDocumentDirty();};Figure.prototype.onContextMenu=function(x,y){var menu=this.getContextMenu();if(menu!=null){this.workflow.showMenu(menu,x,y);}};Figure.prototype.getContextMenu=function(){return null;};Figure.prototype.onDoubleClick=function(){};Figure.prototype.onMouseEnter=function(){};Figure.prototype.onMouseLeave=function(){};Figure.prototype.onDrag=function(){this.x=this.draggable.getLeft();this.y=this.draggable.getTop();if(this.isMoving==false){this.isMoving=true;this.setAlpha(0.5);}this.fireMoveEvent();};Figure.prototype.onDragend=function(){if(this.getWorkflow().getEnableSmoothFigureHandling()==true){var _1168=this;var _1169=function(){if(_1168.alpha<1){_1168.setAlpha(Math.min(1,_1168.alpha+0.05));}else{window.clearInterval(_1168.timer);_1168.timer=-1;}};if(_1168.timer>0){window.clearInterval(_1168.timer);}_1168.timer=window.setInterval(_1169,20);}else{this.setAlpha(1);}this.command.setPosition(this.x,this.y);this.workflow.commandStack.execute(this.command);this.command=null;this.isMoving=false;this.workflow.hideSnapToHelperLines();this.fireMoveEvent();};Figure.prototype.onDragstart=function(x,y){if(!this.canDrag){return false;}this.command=new CommandMove(this,this.x,this.y);return true;};Figure.prototype.setCanDrag=function(flag){this.canDrag=flag;if(flag){this.html.style.cursor="move";}else{this.html.style.cursor=null;}};Figure.prototype.setAlpha=function(_116d){if(this.alpha==_116d){return;}try{this.html.style.MozOpacity=_116d;}catch(exc){}try{this.html.style.opacity=_116d;}catch(exc){}try{var _116e=Math.round(_116d*100);if(_116e>=99){this.html.style.filter="";}else{this.html.style.filter="alpha(opacity="+_116e+")";}}catch(exc){}this.alpha=_116d;};Figure.prototype.setDimension=function(w,h){this.width=Math.max(this.getMinWidth(),w);this.height=Math.max(this.getMinHeight(),h);if(this.html==null){return;}this.html.style.width=this.width+"px";this.html.style.height=this.height+"px";this.fireMoveEvent();if(this.workflow!=null&&this.workflow.getCurrentSelection()==this){this.workflow.showResizeHandles(this);}};Figure.prototype.setPosition=function(xPos,yPos){this.x=xPos;this.y=yPos;if(this.html==null){return;}this.html.style.left=this.x+"px";this.html.style.top=this.y+"px";this.fireMoveEvent();if(this.workflow!=null&&this.workflow.getCurrentSelection()==this){this.workflow.showResizeHandles(this);}};Figure.prototype.isResizeable=function(){return this.resizeable;};Figure.prototype.setResizeable=function(flag){this.resizeable=flag;};Figure.prototype.isSelectable=function(){return this.selectable;};Figure.prototype.setSelectable=function(flag){this.selectable=flag;};Figure.prototype.isStrechable=function(){return true;};Figure.prototype.isDeleteable=function(){return this.deleteable;};Figure.prototype.setDeleteable=function(flag){this.deleteable=flag;};Figure.prototype.setCanSnapToHelper=function(flag){this.canSnapToHelper=flag;};Figure.prototype.getCanSnapToHelper=function(){return this.canSnapToHelper;};Figure.prototype.getSnapToGridAnchor=function(){return this.snapToGridAnchor;};Figure.prototype.setSnapToGridAnchor=function(point){this.snapToGridAnchor=point;};Figure.prototype.getBounds=function(){return new Dimension(this.getX(),this.getY(),this.getWidth(),this.getHeight());};Figure.prototype.getWidth=function(){return this.width;};Figure.prototype.getHeight=function(){return this.height;};Figure.prototype.getY=function(){return this.y;};Figure.prototype.getX=function(){return this.x;};Figure.prototype.getAbsoluteY=function(){return this.y;};Figure.prototype.getAbsoluteX=function(){return this.x;};Figure.prototype.onKeyDown=function(_1178,ctrl){if(_1178==46&&this.isDeleteable()==true){this.workflow.commandStack.execute(new CommandDelete(this));}if(ctrl){this.workflow.onKeyDown(_1178,ctrl);}};Figure.prototype.getPosition=function(){return new Point(this.x,this.y);};Figure.prototype.isOver=function(iX,iY){var x=this.getAbsoluteX();var y=this.getAbsoluteY();var iX2=x+this.width;var iY2=y+this.height;return (iX>=x&&iX<=iX2&&iY>=y&&iY<=iY2);};Figure.prototype.attachMoveListener=function(_1180){if(_1180==null||this.moveListener==null){return;}this.moveListener.add(_1180);};Figure.prototype.detachMoveListener=function(_1181){if(_1181==null||this.moveListener==null){return;}this.moveListener.remove(_1181);};Figure.prototype.fireMoveEvent=function(){this.setDocumentDirty();var size=this.moveListener.getSize();for(var i=0;i<size;i++){this.moveListener.get(i).onOtherFigureMoved(this);}};Figure.prototype.onOtherFigureMoved=function(_1184){};Figure.prototype.setDocumentDirty=function(){if(this.workflow!=null){this.workflow.setDocumentDirty();}};Figure.prototype.generateUId=function(){var chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var _1186=10;var _1187=10;nbTry=0;while(nbTry<1000){var id="";for(var i=0;i<_1186;i++){var rnum=Math.floor(Math.random()*chars.length);id+=chars.substring(rnum,rnum+1);}elem=document.getElementById(id);if(!elem){return id;}nbTry+=1;}return null;};Figure.prototype.disableTextSelection=function(e){if(typeof e.onselectstart!="undefined"){e.onselectstart=function(){return false;};}else{if(typeof e.style.MozUserSelect!="undefined"){e.style.MozUserSelect="none";}}};