/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

Drag=function(){};Drag.current=null;Drag.currentTarget=null;Drag.dragging=false;Drag.isDragging=function(){return this.dragging;};Drag.setCurrent=function(_5d4){this.current=_5d4;this.dragging=true;};Drag.getCurrent=function(){return this.current;};Drag.clearCurrent=function(){this.current=null;this.dragging=false;};Draggable=function(_5d5,_5d6){EventTarget.call(this);this.construct(_5d5,_5d6);this.diffX=0;this.diffY=0;this.targets=new ArrayList();};Draggable.prototype=new EventTarget;Draggable.prototype.construct=function(_5d7,_5d8){this.element=_5d7;this.constraints=_5d8;var _5d9=this;var _5da=function(){var _5db=new DragDropEvent();_5db.initDragDropEvent("dblclick",true);_5d9.dispatchEvent(_5db);var _5dc=arguments[0]||window.event;_5dc.cancelBubble=true;_5dc.returnValue=false;};var _5dd=function(){var _5de=arguments[0]||window.event;var _5df=new DragDropEvent();var _5e0=_5d9.node.workflow.getAbsoluteX();var _5e1=_5d9.node.workflow.getAbsoluteY();var _5e2=_5d9.node.workflow.getScrollLeft();var _5e3=_5d9.node.workflow.getScrollTop();_5df.x=_5de.clientX-_5d9.element.offsetLeft+_5e2-_5e0;_5df.y=_5de.clientY-_5d9.element.offsetTop+_5e3-_5e1;if(_5de.button==2){_5df.initDragDropEvent("contextmenu",true);_5d9.dispatchEvent(_5df);}else{_5df.initDragDropEvent("dragstart",true);if(_5d9.dispatchEvent(_5df)){_5d9.diffX=_5de.clientX-_5d9.element.offsetLeft;_5d9.diffY=_5de.clientY-_5d9.element.offsetTop;Drag.setCurrent(_5d9);if(_5d9.isAttached==true){_5d9.detachEventHandlers();}_5d9.attachEventHandlers();}}_5de.cancelBubble=true;_5de.returnValue=false;};var _5e4=function(){if(Drag.getCurrent()==null){var _5e5=arguments[0]||window.event;if(Drag.currentHover!=null&&_5d9!=Drag.currentHover){var _5e6=new DragDropEvent();_5e6.initDragDropEvent("mouseleave",false,_5d9);Drag.currentHover.dispatchEvent(_5e6);}if(_5d9!=null&&_5d9!=Drag.currentHover){var _5e6=new DragDropEvent();_5e6.initDragDropEvent("mouseenter",false,_5d9);_5d9.dispatchEvent(_5e6);}Drag.currentHover=_5d9;}else{}};if(this.element.addEventListener){this.element.addEventListener("mousemove",_5e4,false);this.element.addEventListener("mousedown",_5dd,false);this.element.addEventListener("dblclick",_5da,false);}else{if(this.element.attachEvent){this.element.attachEvent("onmousemove",_5e4);this.element.attachEvent("onmousedown",_5dd);this.element.attachEvent("ondblclick",_5da);}else{throw new Error("Drag not supported in this browser.");}}};Draggable.prototype.attachEventHandlers=function(){var _5e7=this;_5e7.isAttached=true;this.tempMouseMove=function(){var _5e8=arguments[0]||window.event;var _5e9=new Point(_5e8.clientX-_5e7.diffX,_5e8.clientY-_5e7.diffY);if(_5e7.node.getCanSnapToHelper()){_5e9=_5e7.node.getWorkflow().snapToHelper(_5e7.node,_5e9);}_5e7.element.style.left=_5e9.x+"px";_5e7.element.style.top=_5e9.y+"px";var _5ea=_5e7.node.workflow.getScrollLeft();var _5eb=_5e7.node.workflow.getScrollTop();var _5ec=_5e7.node.workflow.getAbsoluteX();var _5ed=_5e7.node.workflow.getAbsoluteY();var _5ee=_5e7.getDropTarget(_5e8.clientX+_5ea-_5ec,_5e8.clientY+_5eb-_5ed);var _5ef=_5e7.getCompartment(_5e8.clientX+_5ea-_5ec,_5e8.clientY+_5eb-_5ed);if(Drag.currentTarget!=null&&_5ee!=Drag.currentTarget){var _5f0=new DragDropEvent();_5f0.initDragDropEvent("dragleave",false,_5e7);Drag.currentTarget.dispatchEvent(_5f0);}if(_5ee!=null&&_5ee!=Drag.currentTarget){var _5f0=new DragDropEvent();_5f0.initDragDropEvent("dragenter",false,_5e7);_5ee.dispatchEvent(_5f0);}Drag.currentTarget=_5ee;if(Drag.currentCompartment!=null&&_5ef!=Drag.currentCompartment){var _5f0=new DragDropEvent();_5f0.initDragDropEvent("figureleave",false,_5e7);Drag.currentCompartment.dispatchEvent(_5f0);}if(_5ef!=null&&_5ef.node!=_5e7.node&&_5ef!=Drag.currentCompartment){var _5f0=new DragDropEvent();_5f0.initDragDropEvent("figureenter",false,_5e7);_5ef.dispatchEvent(_5f0);}Drag.currentCompartment=_5ef;var _5f1=new DragDropEvent();_5f1.initDragDropEvent("drag",false);_5e7.dispatchEvent(_5f1);};_5e7.tempMouseUp=function(){_5e7.detachEventHandlers();var _5f2=arguments[0]||window.event;var _5f3=new DragDropEvent();_5f3.initDragDropEvent("dragend",false);_5e7.dispatchEvent(_5f3);var _5f4=_5e7.node.workflow.getScrollLeft();var _5f5=_5e7.node.workflow.getScrollTop();var _5f6=_5e7.node.workflow.getAbsoluteX();var _5f7=_5e7.node.workflow.getAbsoluteY();var _5f8=_5e7.getDropTarget(_5f2.clientX+_5f4-_5f6,_5f2.clientY+_5f5-_5f7);var _5f9=_5e7.getCompartment(_5f2.clientX+_5f4-_5f6,_5f2.clientY+_5f5-_5f7);if(_5f8!=null){var _5fa=new DragDropEvent();_5fa.initDragDropEvent("drop",false,_5e7);_5f8.dispatchEvent(_5fa);}if(_5f9!=null&&_5f9.node!=_5e7.node){var _5fa=new DragDropEvent();_5fa.initDragDropEvent("figuredrop",false,_5e7);_5f9.dispatchEvent(_5fa);}if(Drag.currentTarget!=null){var _5fa=new DragDropEvent();_5fa.initDragDropEvent("dragleave",false,_5e7);Drag.currentTarget.dispatchEvent(_5fa);Drag.currentTarget=null;}Drag.currentCompartment=null;Drag.clearCurrent();};if(document.body.addEventListener){document.body.addEventListener("mousemove",this.tempMouseMove,false);document.body.addEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.attachEvent){document.body.attachEvent("onmousemove",this.tempMouseMove);document.body.attachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};Draggable.prototype.detachEventHandlers=function(){this.isAttached=false;if(document.body.removeEventListener){document.body.removeEventListener("mousemove",this.tempMouseMove,false);document.body.removeEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.detachEvent){document.body.detachEvent("onmousemove",this.tempMouseMove);document.body.detachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};Draggable.prototype.getDropTarget=function(x,y){for(var i=0;i<this.targets.getSize();i++){var _5fe=this.targets.get(i);if(_5fe.node.isOver(x,y)&&_5fe.node!=this.node){return _5fe;}}return null;};Draggable.prototype.getCompartment=function(x,y){var _601=null;for(var i=0;i<this.node.workflow.compartments.getSize();i++){var _603=this.node.workflow.compartments.get(i);if(_603.isOver(x,y)&&_603!=this.node){if(_601==null){_601=_603;}else{if(_601.getZOrder()<_603.getZOrder()){_601=_603;}}}}return _601==null?null:_601.dropable;};Draggable.prototype.getLeft=function(){return this.element.offsetLeft;};Draggable.prototype.getTop=function(){return this.element.offsetTop;};DragDropEvent=function(){Event.call(this);};DragDropEvent.prototype=new Event();DragDropEvent.prototype.initDragDropEvent=function(_604,_605,_606){this.initEvent(_604,_605);this.relatedTarget=_606;};DropTarget=function(_607){EventTarget.call(this);this.construct(_607);};DropTarget.prototype=new EventTarget;DropTarget.prototype.construct=function(_608){this.element=_608;};DropTarget.prototype.getLeft=function(){var el=this.element;var ol=el.offsetLeft;while((el=el.offsetParent)!=null){ol+=el.offsetLeft;}return ol;};DropTarget.prototype.getTop=function(){var el=this.element;var ot=el.offsetTop;while((el=el.offsetParent)!=null){ot+=el.offsetTop;}return ot;};DropTarget.prototype.getHeight=function(){return this.element.offsetHeight;};DropTarget.prototype.getWidth=function(){return this.element.offsetWidth;};